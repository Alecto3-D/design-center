body common control {

    bundlesequence => { "main",};

    inputs => {
                "../../external_tools/cfsketch/copbl/cfengine_stdlib.cf",
                "./main.cf",
              };
}

bundle agent main {
vars:
    "check_dummy_OK_plugin_name" string => "check_dummy";
    "check_dummy_OK_args" string => "0 Test ok";
    "check_dummy_OK_usebundle" string => "handler_";

# the rest left as an exercise for Nick ;)

    # #  cf-agent -D superdupermop -KIf ./test.cf
    # # this reports even when not run but it shouldnt
    # # Maybe I am doing something wrong, maybe isvariable doesn't work with module set variables
    # "check[check_dummy_DONTRUN][plugin_name]" string => "check_dummy";
    # "check[check_dummy_DONTRUN][args]" string => "0 Test ok";
    # "check[check_dummy_DONTRUN][_usebundle_if_ok]" string => "bundleifok";
    # "check[check_dummy_DONTRUN][_execution_context]" string => "superdupermop";


    # "check[check_dummy_WARN][plugin_name]" string => "check_dummy";
    # "check[check_dummy_WARN][args]" string => "1 Test warn";
    # "check[check_dummy_WARN][_usebundle_if_warning]" string => "bundleifwarn";

    # "check[check_dummy_CRIT][plugin_name]" string => "check_dummy";
    # "check[check_dummy_CRIT][args]" string => "2 Test critical";
    # "check[check_dummy_CRIT][_usebundle_if_critical]" string => "bundleifcritical";

    # "check[check_dummy_UNKNOWN][plugin_name]" string => "check_dummy";
    # "check[check_dummy_UNKNOWN][args]" string => "3 Test unknown";
    # "check[check_dummy_UNKNOWN][_usebundle_if_critical]" string => "bundleifunknown";

    # "check[check_dummy_PROTOERROR][plugin_name]" string => "check_dummy";
    # "check[check_dummy_PROTOERROR][args]" string => "4 Test protocal error";
    # "check[check_dummy_PROTOERROR][_usebundle_if_protocol_error]" string => "bundleifprotoerror";

methods:
    "any" usebundle => nagios_plugin_agent("main.check_dummy_OK_");
}

bundle agent handler_ok{
reports:
    cfengine::
        "THE CHECK WAS OK THIS IS FROM THE CALLED BUNDLE";
}


bundle agent handler_warn{
reports:
    cfengine::
        "THE CHECK WAS in WARNING  THIS IS FROM THE CALLED BUNDLE";
}

bundle agent handler_critical{
reports:
    cfengine::
        "THE CHECK WAS in CRITICAL  THIS IS FROM THE CALLED BUNDLE";
}

bundle agent handler_unknown{
reports:
    cfengine::
        "THE CHECK WAS in UNKNOWN  THIS IS FROM THE CALLED BUNDLE";
}

bundle agent handler_protoerror{
reports:
    cfengine::
        "THE CHECK WAS in PROTOCOL ERROR  THIS IS FROM THE CALLED BUNDLE";
}

